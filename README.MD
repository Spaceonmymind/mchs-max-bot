# Чат-бот Департамента гражданской защиты Курганской области

Бот предоставляет:

* инструкции и рекомендации при чрезвычайных ситуациях
* справку о службах и экстренных номерах
* ответы на частые вопросы
* удобную навигацию по категориям и темам
* возможность отправить обращение оператору через чат
* отдельную **админ-панель** для обработки обращений

Бот написан на Node.js, упакован в Docker и поддерживает полноценное развёртывание через `docker-compose`.

---

# Возможности бота

### Базовая функциональность

* автоматическое приветствие при первом запуске (`bot_started`)
* отображение логотипа с вложением
* структуированное меню категорий и тем
* кнопка «Назад»
* автоочистка чата для удобной навигации
* обработка пользовательских сообщений

### Приём обращений

* пользователь может отправить сообщение
* бот запрашивает номер телефона
* сохраняет обращение в `src/data/emergencies.json`
* хранит:

  * chatId (диалог c пользователем)
  * тип сообщения
  * телефон
  * текст сообщения
  * timestamp
  * статус (`new`, `read`, `answered`)

### Админ-панель (Web UI)

* доступна по адресу: `http://SERVER_IP:3030/admin`
* показывает таблицу всех обращений
* позволяет:
  * отметить обращение прочитанным
  * отправить ответ пользователю
* ответ отправляется обратно в чат бота через API MAX

Админ-панель запускается в том же контейнере, что и бот.

---

# Структура проекта

```
mchs-max-bot/
│
├── src/
│   ├── handlers/          # обработчики команд и кнопок
│   ├── utils/             # утилиты: cleanChat, state, getChatId
│   ├── data/
│   │     └── emergencies.json   # обращения (том монтируется в Docker)
│
├── assets/
│     └── logo.png
│
├── bot.js                 # основной файл бота
├── adminServer.js         # веб-интерфейс оператора
│
├── package.json
├── Dockerfile
├── docker-compose.yml
└── README.md
```

---

# Запуск через Docker

## 1. Установить Docker и Docker Compose

Для Linux:

```
sudo apt install docker.io docker-compose
```

Проверь версии:

```
docker -v
docker-compose -v
```

---

## 2. Клонировать проект

```
git clone <репозиторий>
cd mchs-max-bot
```

---

## 3. Создать `.env`

```
BOT_TOKEN=<токен бота MAX>
```
---

## 4. Запустить проект

```
docker-compose up -d --build
```

### Что произойдёт:

* бот запустится
* админ-панель поднимется на порту 3030
* JSON с обращениями будет храниться на хостовой машине

---

## 5. Доступ к админ-панели

### Локально:

```
http://localhost:3030/admin
```

### С сервера:

```
http://SERVER_IP:3030/admin
```

---

# Обновление

```
git pull
docker-compose down
docker-compose up -d --build
```

---

# Логи

### Бот + админка:

```
docker logs -f mchs_max_bot
```

